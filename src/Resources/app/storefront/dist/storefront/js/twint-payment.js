"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["twint-payment"],{4301:(t,e,i)=>{var o,r,n,s=i(6285),a=i(3206),l=i(8254);i(4690);class c extends s.Z{init(){this.httpClient=new l.Z,this.domain="",window.hasOwnProperty("storefrontUrl")&&(this.domain=window.storefrontUrl),this.pageSelector=a.Z.querySelector(document,this.options.pageSelector),this.appSelector=a.Z.querySelector(document,this.options.appSelector),this.qrCodeSelectors=a.Z.querySelectorAll(document,this.options.qrCodeSelector),this.appLinkSelector=a.Z.querySelector(document,this.options.appLinkSelector),this.bankSelectors=a.Z.querySelectorAll(this.appSelector,".bank-logo",!1),this.orderNumber=this.pageSelector.getAttribute("data-order-number"),this.isMobile=this.pageSelector.getAttribute("data-mobile"),this.isAndroidMobile=this.pageSelector.getAttribute("data-is-android-device"),this.statusOrderEndpoint=this.domain+"/payment/order/"+this.orderNumber,this._registerEvents()}_registerEvents(){this.bankSelectors&&this.bankSelectors.forEach((t=>{t.addEventListener("touchend",(e=>{this.onClickBank(e,t)}))})),this.appLinkSelector&&this.appLinkSelector.addEventListener("change",this.onChangeAppList.bind(this));var t=localStorage.getItem(this.options.lastReloadTimeKey),e=Date.now(),i=1e3*this.options.intervalCheck;if((!t||e-t>i)&&this.reloadPage(this),this.reloadPageInterval=setInterval((()=>{this.reloadPage(this)}),i),this.isMobile&&this.isAndroidMobile){let t=this.pageSelector.getAttribute("data-android-link");window.location.replace(t);const e=setInterval((()=>{window.location.href!==t&&this.showMobileQrCode(),clearInterval(e)}),1e3*this.options.appCountDownInterval)}}onClickBank(t,e){var i=e.getAttribute("data-link");this.openAppBank(i)}onChangeAppList(t){const e=t.target;let i=e.options[e.selectedIndex].value;this.openAppBank(i)}openAppBank(t){if(t){window.location.replace(t);const e=setInterval((()=>{window.location.href!==t&&this.showMobileQrCode(),clearInterval(e)}),1e3*this.options.appCountDownInterval)}}reloadPage(){localStorage.setItem(this.options.lastReloadTimeKey,Date.now()),this.httpClient.get(this.statusOrderEndpoint,(t=>{try{const e=JSON.parse(t);"boolean"==typeof e.reload&&e.reload&&(clearInterval(this.reloadPageInterval),location.reload())}catch(t){}}),"application/json",!0)}showMobileQrCode(){this.qrCodeSelectors.forEach((t=>{t.style.display="block"}))}}function h(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}o=c,n={pageSelector:".qr-waiting-container",appSelector:"#logo-container",appLinkSelector:"#app-chooser",qrCodeSelector:".qr-code-mobile",lastReloadTimeKey:"lastReloadTime",appCountDownInterval:10,intervalCheck:10},(r=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(r="options"))in o?Object.defineProperty(o,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[r]=n;class p extends s.Z{constructor(...t){super(...t),h(this,"loadingPopup",null)}_init(){this.checking=!1,this.client=new l.Z,this.options.useCart||(this.form=this.el.closest(this.options.formSelector)),this._registerEvents()}getLineItems(){if(this.options.useCart)return[];const t=new FormData(this.form),e={},i=/lineItems\[[^\]]+\]\[([^\]]+)\]/;t.forEach(((t,o)=>{if(o.startsWith("lineItems")){const r=o.match(i);if(r&&r[1]){switch(r[1]){case"stackable":case"removable":t="1"===t;break;case"quantity":t=parseInt(t)}e[r[1]]=t}}}));const o=[];return o.push(e),o}_registerEvents(){this.el.addEventListener("click",this.onClick.bind(this))}getLoadingPopup(){return this.loadingPopup||(this.loadingPopup=window.PluginManager.getPluginInstanceFromElement(document.querySelector("#twint-loading-popup"),"TwintLoadingPopup")),this.loadingPopup}onClick(t){if(!this.checking)return this.checking=!0,this.client.abort(),this.getLoadingPopup().show(),this.client.post("/twint/express-checkout",JSON.stringify({lineItems:this.getLineItems(),useCart:this.options.useCart}),this.onFinish.bind(this)),t.stopPropagation(),t.preventDefault(),!1}onFinish(t,e){if(this.checking=!1,this.getLoadingPopup().hide(),200!==e.status)this.onError(t);else{const e=JSON.parse(t);window.location.href=this.baseUrl()+e.redirectUrl}}onError(t){console.log("Express checkout error: ",t)}baseUrl(){return window.location.protocol+"//"+window.location.host}}function u(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}h(p,"options",{formSelector:"form",useCart:!1});class d extends s.Z{constructor(...t){super(...t),u(this,"count",0)}init(){this.checking=!1,this.client=new l.Z,this.checkStatus()}checkStatus(){this.checking||this.count>10||(this.count++,this.checking=!0,this.client.get("/payment/monitoring/"+this.options.pairingHash,(t=>{const e=JSON.parse(t);this.checking=!1,e.completed?window.location.reload():setTimeout(this.checkStatus.bind(this),this.options.interval)})))}}function g(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}u(d,"options",{pairingHash:null,interval:1e3});class m extends s.Z{constructor(...t){super(...t),g(this,"active",!1)}init(){this.checking=!1,this.el=a.Z.querySelector(document,"#twint-loading-popup")}show(){this.active=!0,this.el.classList.add("active")}hide(){this.active=!1,this.el.classList.remove("active")}}const f=window.PluginManager;f.register("AppSwitchHandler",c,"[data-app-selector]"),f.register("TwintExpressCheckoutButton",p,"[data-twint-express-checkout-button]"),f.register("TwintPaymentStatusRefresh",d,"[data-twint-payment-status-refresh]"),f.register("TwintLoadingPopup",m,"[data-twint-loading-popup]")}},t=>{t.O(0,["vendor-node","vendor-shared"],(()=>{return e=4301,t(t.s=e);var e}));t.O()}]);