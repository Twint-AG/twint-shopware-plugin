(self.webpackChunk=self.webpackChunk||[]).push([["twint-payment"],{2615:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(3637),o=i(8254),r=i(7906);let s=null;class a extends n.Z{static open(t=!1,e=!1,i=null,o="left",r=!0,s=n.Z.REMOVE_OFF_CANVAS_DELAY(),a=!1,c=""){if(!t)throw new Error("A url must be given!");n.r._removeExistingOffCanvas();const l=n.r._createOffCanvas(o,a,c,r);this.setContent(t,e,i,r,s),n.r._openOffcanvas(l)}static setContent(t,e,i,n,c){const l=new o.Z;super.setContent(`<div class="offcanvas-body">${r.Z.getTemplate()}</div>`,n,c),s&&s.abort();const u=t=>{super.setContent(t,n,c),"function"==typeof i&&i(t)};s=e?l.post(t,e,a.executeCallback.bind(this,u)):l.get(t,a.executeCallback.bind(this,u))}static executeCallback(t,e){"function"==typeof t&&t(e),window.PluginManager.initializePlugins()}}},3637:(t,e,i)=>{"use strict";i.d(e,{Z:()=>u,r:()=>l});var n=i(9658),o=i(2005),r=i(1966);const s="offcanvas",a=350;class c{constructor(){this.$emitter=new o.Z}open(t,e,i,n,o,r,s){this._removeExistingOffCanvas();const a=this._createOffCanvas(i,r,s,n);this.setContent(t,n,o),this._openOffcanvas(a,e)}setContent(t,e,i){const n=this.getOffCanvas();n[0]&&(n[0].innerHTML=t,this._registerEvents(i))}setAdditionalClassName(t){this.getOffCanvas()[0].classList.add(t)}getOffCanvas(){return document.querySelectorAll(`.${s}`)}close(t){const e=this.getOffCanvas();r.Z.iterate(e,(t=>{bootstrap.Offcanvas.getInstance(t).hide()})),setTimeout((()=>{this.$emitter.publish("onCloseOffcanvas",{offCanvasContent:e})}),t)}goBackInHistory(){window.history.back()}exists(){return this.getOffCanvas().length>0}_openOffcanvas(t,e){c.bsOffcanvas.show(),window.history.pushState("offcanvas-open",""),"function"==typeof e&&e()}_registerEvents(t){const e=n.Z.isTouchDevice()?"touchend":"click",i=this.getOffCanvas();r.Z.iterate(i,(e=>{const n=()=>{setTimeout((()=>{e.remove(),this.$emitter.publish("onCloseOffcanvas",{offCanvasContent:i})}),t),e.removeEventListener("hide.bs.offcanvas",n)};e.addEventListener("hide.bs.offcanvas",n)})),window.addEventListener("popstate",this.close.bind(this,t),{once:!0});const o=document.querySelectorAll(".js-offcanvas-close");r.Z.iterate(o,(i=>i.addEventListener(e,this.close.bind(this,t))))}_removeExistingOffCanvas(){c.bsOffcanvas=null;const t=this.getOffCanvas();return r.Z.iterate(t,(t=>t.remove()))}_getPositionClass(t){return"left"===t?"offcanvas-start":"right"===t?"offcanvas-end":`offcanvas-${t}`}_createOffCanvas(t,e,i,n){const o=document.createElement("div");if(o.classList.add(s),o.classList.add(this._getPositionClass(t)),!0===e&&o.classList.add("is-fullwidth"),i){const t=typeof i;if("string"===t)o.classList.add(i);else{if(!Array.isArray(i))throw new Error(`The type "${t}" is not supported. Please pass an array or a string.`);i.forEach((t=>{o.classList.add(t)}))}}return document.body.appendChild(o),c.bsOffcanvas=new bootstrap.Offcanvas(o,{backdrop:!1!==n||"static"}),o}}const l=Object.freeze(new c);class u{static open(t,e=null,i="left",n=!0,o=350,r=!1,s=""){l.open(t,e,i,n,o,r,s)}static setContent(t,e=!0,i=350){l.setContent(t,e,i)}static setAdditionalClassName(t){l.setAdditionalClassName(t)}static close(t=350){l.close(t)}static exists(){return l.exists()}static getOffCanvas(){return l.getOffCanvas()}static REMOVE_OFF_CANVAS_DELAY(){return a}}},7260:t=>{t.exports=function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=i[s]={exports:{}};e[s][0].call(l.exports,(function(t){var i=e[s][1][t];return o(i||t)}),l,l.exports,t,e,i,n)}return i[s].exports}for(var r=void 0,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){var n=t("closest"),o=t("component-event"),r=["focus","blur"];i.bind=function(t,e,i,s,a){return-1!==r.indexOf(i)&&(a=!0),o.bind(t,i,(function(i){var o=i.target||i.srcElement;i.delegateTarget=n(o,e,!0,t),i.delegateTarget&&s.call(t,i)}),a)},i.unbind=function(t,e,i,n){-1!==r.indexOf(e)&&(n=!0),o.unbind(t,e,i,n)}},{closest:2,"component-event":4}],2:[function(t,e,i){var n=t("matches-selector");e.exports=function(t,e,i){for(var o=i?t:t.parentNode;o&&o!==document;){if(n(o,e))return o;o=o.parentNode}}},{"matches-selector":3}],3:[function(t,e,i){var n=Element.prototype,o=n.matchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector;function r(t,e){if(o)return o.call(t,e);for(var i=t.parentNode.querySelectorAll(e),n=0;n<i.length;++n)if(i[n]==t)return!0;return!1}e.exports=r},{}],4:[function(t,e,i){var n=window.addEventListener?"addEventListener":"attachEvent",o=window.removeEventListener?"removeEventListener":"detachEvent",r="addEventListener"!==n?"on":"";i.bind=function(t,e,i,o){return t[n](r+e,i,o||!1),i},i.unbind=function(t,e,i,n){return t[o](r+e,i,n||!1),i}},{}],5:[function(t,e,i){function n(){}n.prototype={on:function(t,e,i){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){var n=this,o=function(){n.off(t,o),e.apply(i,arguments)};return this.on(t,o,i)},emit:function(t){for(var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),n=0,o=i.length;n<o;n++)i[n].fn.apply(i[n].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),n=i[t],o=[];if(n&&e)for(var r=0,s=n.length;r<s;r++)n[r].fn!==e&&o.push(n[r]);return o.length?i[t]=o:delete i[t],this}},e.exports=n},{}],6:[function(t,e,i){"use strict";i.__esModule=!0;var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(e){o(this,t),this.resolveOptions(e),this.initSelection()}return t.prototype.resolveOptions=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action=t.action,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""},t.prototype.initSelection=function(){if(this.text&&this.target)throw new Error('Multiple attributes declared, use either "target" or "text"');if(this.text)this.selectFake();else{if(!this.target)throw new Error('Missing required attributes, use either "target" or "text"');this.selectTarget()}},t.prototype.selectFake=function(){var t=this;this.removeFake(),this.fakeHandler=document.body.addEventListener("click",(function(){return t.removeFake()})),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.position="absolute",this.fakeElem.style.left="-9999px",this.fakeElem.style.top=document.body.scrollTop+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.selectedText=this.text,document.body.appendChild(this.fakeElem),this.fakeElem.select(),this.copyText()},t.prototype.removeFake=function(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},t.prototype.selectTarget=function(){if("INPUT"===this.target.nodeName||"TEXTAREA"===this.target.nodeName)this.target.select(),this.selectedText=this.target.value;else{var t=document.createRange(),e=window.getSelection();t.selectNodeContents(this.target),e.addRange(t),this.selectedText=e.toString()}this.copyText()},t.prototype.copyText=function(){var t=void 0;try{t=document.execCommand(this.action)}catch(e){t=!1}this.handleResult(t)},t.prototype.handleResult=function(t){t?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},t.prototype.clearSelection=function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},t.prototype.destroy=function(){this.removeFake()},n(t,[{key:"action",set:function(){var t=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=t,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(void 0!==t){if(!t||"object"!=typeof t||1!==t.nodeType)throw new Error('Invalid "target" value, use a valid Element');this._target=t}},get:function(){return this._target}}]),t}();i.default=r,e.exports=i.default},{}],7:[function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}i.__esModule=!0;var s=n(t("./clipboard-action")),a=n(t("delegate-events")),c=function(t){function e(i,n){o(this,e),t.call(this),this.resolveOptions(n),this.delegateClick(i)}return r(e,t),e.prototype.resolveOptions=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText},e.prototype.delegateClick=function(t){var e=this;this.binding=a.default.bind(document.body,t,"click",(function(t){return e.onClick(t)}))},e.prototype.undelegateClick=function(){a.default.unbind(document.body,"click",this.binding)},e.prototype.onClick=function(t){this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new s.default({action:this.action(t.delegateTarget),target:this.target(t.delegateTarget),text:this.text(t.delegateTarget),trigger:t.delegateTarget,emitter:this})},e.prototype.defaultAction=function(t){return l("action",t)},e.prototype.defaultTarget=function(t){var e=l("target",t);if(e)return document.querySelector(e)},e.prototype.defaultText=function(t){return l("text",t)},e.prototype.destroy=function(){this.undelegateClick(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},e}(n(t("tiny-emitter")).default);function l(t,e){var i="data-clipboard-"+t;if(e.hasAttribute(i))return e.getAttribute(i)}i.default=c,e.exports=i.default},{"./clipboard-action":6,"delegate-events":1,"tiny-emitter":5}]},{},[7])(7)},6633:(t,e,i)=>{"use strict";var n,o,r,s=i(6285),a=i(3206);class c extends s.Z{init(){var t,e,i;this.$container=a.Z.querySelector(document,this.options.pageSelector),this.isMobile=null!==(t=this.$container.getAttribute("data-mobile"))&&void 0!==t&&t,this.isAndroid=null!==(e=this.$container.getAttribute("data-is-android-device"))&&void 0!==e&&e,this.isIos=null!==(i=this.$container.getAttribute("data-is-ios-device"))&&void 0!==i&&i,this.isIos&&this.handleIos(),this.isAndroid&&this.handleAndroid()}handleIos(){this.$_apps=a.Z.querySelector(document,this.options.appSelector),this.$qrCode=a.Z.querySelectorAll(document,this.options.qrCodeSelector),this.$appLinks=a.Z.querySelector(document,this.options.appLinkSelector),this.$banks=a.Z.querySelectorAll(this.$_apps,".bank-logo",!1),this.$banks&&this.$banks.forEach((t=>{t.addEventListener("touchend",(e=>{this.onClickBank(e,t)}))})),this.$appLinks&&this.$appLinks.addEventListener("change",this.onChangeAppList.bind(this))}handleAndroid(){this.$qrCode=a.Z.querySelectorAll(document,this.options.qrCodeSelector);let t=this.$container.getAttribute("data-android-link");window.location.replace(t);const e=setInterval((()=>{this.showMobileQrCode(),clearInterval(e)}),1e3*this.options.appCountDownInterval)}onClickBank(t,e){var i=e.getAttribute("data-link");this.openAppBank(i)}onChangeAppList(t){const e=t.target;let i=e.options[e.selectedIndex].value;this.openAppBank(i)}openAppBank(t){if(t)try{window.location.replace(t);const e=setInterval((()=>{window.location.href!==t&&this.showMobileQrCode(),clearInterval(e)}),1e3*this.options.appCountDownInterval)}catch(t){this.showMobileQrCode()}}showMobileQrCode(){this.$qrCode.forEach((t=>{t.classList.remove("d-none")}))}}n=c,r={pageSelector:".twint-qr-container",appSelector:"#logo-container",appLinkSelector:"#app-chooser",qrCodeSelector:".qr-code",appCountDownInterval:2},(o=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(o="options"))in n?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r;var l=i(8254),u=i(378),h=i(1966);function d(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class p extends s.Z{constructor(...t){super(...t),d(this,"loadingPopup",null)}init(){this.checking=!1,this.client=new l.Z,this.options.useCart||(this.form=this.el.closest(this.options.formSelector)),p.modal||(p.modal=new u.Z("",!0,".js-twint-modal-template",".js-twint-modal-template-content-element",".js-twint-modal-template-title-element")),this._registerEvents()}getLineItems(){if(this.options.useCart)return[];const t=new FormData(this.form),e={},i=/lineItems\[[^\]]+\]\[([^\]]+)\]/;t.forEach(((t,n)=>{if(n.startsWith("lineItems")){const o=n.match(i);if(o&&o[1]){switch(o[1]){case"stackable":case"removable":t="1"===t;break;case"quantity":t=parseInt(t)}e[o[1]]=t}}}));const n=[];return n.push(e),n}_registerEvents(){this.el.addEventListener("click",this.onClick.bind(this))}getLoadingPopup(){return this.loadingPopup||(this.loadingPopup=window.PluginManager.getPluginInstanceFromElement(document.querySelector("#twint-loading-popup"),"TwintLoadingPopup")),this.loadingPopup}onClick(t){if(!this.checking)return this.checking=!0,this.client.abort(),this.getLoadingPopup().show(),this.client.post(window.router["frontend.twint.express-checkout"],JSON.stringify({lineItems:this.getLineItems(),useCart:this.options.useCart}),this.onFinish.bind(this)),t.stopPropagation(),t.preventDefault(),!1}onFinish(t,e){if(this.getLoadingPopup().hide(),200!==e.status)this.onError(t);else{const e=JSON.parse(t);e.hasOwnProperty("needAddProductToCart")&&e.needAddProductToCart&&!1===this.options.useCart?this.onAddProductToCart():this.onModalLoaded(e.content)}}onModalLoaded(t){this.checking=!1,p.modal.open(),p.modal.updateContent(t),window.PluginManager.initializePlugin("TwintPaymentStatusRefresh","[data-twint-payment-status-refresh]"),window.PluginManager.initializePlugin("TwintCopyToken","[data-twint-copy-token]"),window.PluginManager.initializePlugin("TwintAppSwitchHandler","[data-app-selector]")}onAddProductToCart(){this.checking=!1;const t=window.router["frontend.checkout.line-item.add"];let e=new FormData;for(const t of this.getLineItems())for(const[i,n]of Object.entries(t))e.append("lineItems["+t.id+"]["+i+"]",n);e.append("redirectTo","frontend.cart.offcanvas");const i=PluginManager.getPluginInstances("OffCanvasCart");h.Z.iterate(i,(i=>{i.openOffCanvas(t,e,(()=>{this.$emitter.publish("openOffCanvasCart")}))}))}onError(t){console.log("Express checkout error: ",t)}}d(p,"options",{formSelector:"form",useCart:!1}),d(p,"modal",null);var f=i(2615);function g(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class v extends s.Z{constructor(...t){super(...t),g(this,"count",0)}init(){this.checking=!1,this.client=new l.Z,this.options.expressCheckout?this.checkExpressCheckoutStatus():(this.$container=a.Z.querySelector(document,this.options.containerSelector),this.orderNumber=this.$container.getAttribute("data-order-number"),this.checkRegularCheckoutStatus())}getDomain(){return this.domain="",window.hasOwnProperty("storefrontUrl")&&(this.domain=window.storefrontUrl),this.domain}reachLimit(){return!!(this.checking||this.count>10)||(this.count++,this.checking=!0,!1)}checkExpressCheckoutStatus(){if(this.reachLimit())return;let t=window.router["frontend.twint.monitoring"];t=t.replace("--hash--",this.options.pairingHash),this.client.get(t,(t=>{const e=JSON.parse(t);if(this.checking=!1,e.completed)if(e.orderId){const t=window.PluginManager.getPluginInstances("CartWidget");h.Z.iterate(t,(t=>t.fetch())),this.$emitter.publish("fetchCartWidgets"),f.Z.close(),this.loadThankYouPage()}else p.modal.close();else setTimeout(this.checkExpressCheckoutStatus.bind(this),this.options.interval)}))}loadThankYouPage(){let t=window.router["frontend.twint.express"];t=t.replace("--hash--",this.options.pairingHash),this.client.get(t,this.ThankYouPageLoaded.bind(this))}ThankYouPageLoaded(t){p.modal.updateContent(t);let e=a.Z.querySelector(document,".js-pseudo-modal .twint-modal .modal-title");e.innerHTML=e.getAttribute("data-finish")}checkRegularCheckoutStatus(){if(this.reachLimit())return;let t=window.router["frontend.twint.order"];t=t.replace("--number--",this.orderNumber),this.client.get(t,(t=>{this.checking=!1;try{const e=JSON.parse(t);"boolean"==typeof e.reload&&e.reload?location.reload():setTimeout(this.checkRegularCheckoutStatus.bind(this),this.options.interval)}catch(t){}}),"application/json",!0)}}function m(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}g(v,"options",{containerSelector:".twint-qr-container",pairingHash:null,interval:1e3,expressCheckout:!1});class b extends s.Z{constructor(...t){super(...t),m(this,"active",!1)}init(){this.checking=!1,this.el=a.Z.querySelector(document,"#twint-loading-popup")}show(){this.active=!0,this.el.classList.add("active")}hide(){this.active=!1,this.el.classList.remove("active")}}var y=i(7260),w=i.n(y);function k(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class C extends s.Z{constructor(...t){super(...t),k(this,"clipboard",null)}init(){this.input=a.Z.querySelector(this.el,this.options.target),this.button=a.Z.querySelector(this.el,this.options.selector),this.button.addEventListener("click",this.onClick.bind(this)),this.clipboard=new(w())(this.options.selector),this.clipboard.on("success",this.onCopied.bind(this)),this.clipboard.on("error",this.onError.bind(this))}onClick(t){t.preventDefault(),this.input.disabled=!1}onCopied(t){t.clearSelection(),this.button.innerHTML="Copied!",this.button.classList.add("copied"),this.input.disabled=!0}onError(t){}}k(C,"options",{selector:"#btn-copy-token",target:"#qr-token"});const E=window.PluginManager;E.register("TwintAppSwitchHandler",c,"[data-app-selector]"),E.register("TwintExpressCheckoutButton",p,"[data-twint-express-checkout-button]"),E.register("TwintPaymentStatusRefresh",v,"[data-twint-payment-status-refresh]"),E.register("TwintLoadingPopup",b,"[data-twint-loading-popup]"),E.register("TwintCopyToken",C,"[data-twint-copy-token]")}},t=>{t.O(0,["vendor-node","vendor-shared"],(()=>{return e=6633,t(t.s=e);var e}));t.O()}]);