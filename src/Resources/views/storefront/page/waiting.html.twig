{% sw_extends '@Storefront/storefront/base.html.twig' %}

{% block base_content %}
    {% block page_checkout %}
        <script>
            function reloadPage() {
                localStorage.setItem('lastReloadTime', Date.now());
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/payment/order/{{ orderNumber }}', true);
                xhr.onload = function () {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        var jsonResponse = JSON.parse(xhr.responseText);
                        if(jsonResponse.reload){
                            location.reload();
                        }
                    }
                };
                xhr.onerror = function () {};
                xhr.send();
            }

            window.onload = function() {
                var lastReloadTime = localStorage.getItem('lastReloadTime');
                var currentTime = Date.now();
                var reloadInterval = 1 * 60 * 1000; // 1 minute to check
                if (!lastReloadTime || (currentTime - lastReloadTime > reloadInterval)) {
                    reloadPage();
                }
                setInterval(reloadPage, reloadInterval);
            };
        </script>
        <div class="checkout">
            {% block page_checkout_container %}
                <div class="checkout-container">
                    {% if payLinks is defined and payLinks.android is defined  %}
                        <script>
                            window.location = '{{ payLinks.android[0] }}'
                        </script>
                    {% elseif payLinks is defined and payLinks.ios is defined %}
                        {% sw_include '@Storefront/storefront/page/app-selector-modal.html.twig' with {
                            payLinks: payLinks.ios
                        } %}
                    {% endif %}
                    {% block page_checkout_main %}
                        <div class="checkout-main">
                            {% block base_flashbags_checkout %}
                                <div class="flashbags">
                                    {% for type, messages in app.flashes %}
                                        {% sw_include '@Storefront/storefront/utilities/alert.html.twig' with { type: type, list: messages } %}
                                    {% endfor %}
                                </div>
                            {% endblock %}

                            {% block page_checkout_main_content %}{% endblock %}
                        </div>
                    {% endblock %}

                    {% block page_checkout_additional %}
                        <div class="checkout-qr-code">
                            <h2 class="qr-head">{{ "twintPayment.waitingPage.headline"|trans({'%orderNumber%': orderNumber}) }}</h2>
                            <div class="qr-total-summary">
                                <h2>
                                    {{ order.price.rawTotal|currency }}{% if order.price.taxStatus == "gross" %}{% endif %}
                                </h2>
                            </div>
                            <div class="qr-body">
                                <div class="row">
                                    <div class="col-sm-6 qr-container">
                                        {% if qrCode %}
                                            <img src="{{ qrCode }}" alt="QR-Code"/>
                                        {% endif %}
                                    </div>
                                    <div class="col-sm-6 token-container" style="t">
                                        <div>
                                            <h2>{{ pairingToken }}</h2>
                                        </div>

                                    </div>
                                </div>
                                <div class="row">
                                    <h3>{{ "twintPayment.waitingPage.description"|trans() }}</h3>
                                </div>
                            </div>
                        </div>
                    {% endblock %}
                </div>
            {% endblock %}
        </div>
    {% endblock %}



{% endblock %}
